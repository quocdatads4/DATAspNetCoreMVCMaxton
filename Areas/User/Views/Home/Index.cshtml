@model DATAspNetCoreMVCMaxton.Areas.User.Models._UserMainDTO


@{
	ViewBag.Title = "Tài khoản";
	ViewBag.pTitle = "Thông tin tài khoản";
	Layout = "~/Areas/User/Views/Shared/_Main.cshtml";
}

@section styles {
	<link href="~/assets/plugins/datatable/css/dataTables.bootstrap5.min.css" rel="stylesheet" />
}




<!-- Phần thẻ HTML để hiển thị thông báo -->
<div id="groupMessage" class="alert alert-info" style="display: none;"></div>

<!-- Thẻ select để người dùng chọn nhóm -->
<select name="SelectedProfileGroup" id="SelectedProfileGroup" class="form-select">
    <option value="0">Chọn nhóm</option>
    <option value="5">DATMarketing</option>
    <!-- Thêm các option khác -->
</select>



<!-- Table hiển thị dữ liệu ProfileOrbitas -->
<div class="table-responsive">
    <table id="profileOrbitaTable" class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>Chọn</th>
                <th>Profile ID</th>
                <th>Profile Name</th>
                <th>IP</th>
                <th>Country</th>
                <th>Trạng thái</th>
                <th>Nhóm</th>
                <th>Hành động</th>
                <th>Cập nhật</th>
            </tr>
        </thead>
        <tbody id="profileOrbitaTableBody">
            <!-- Dữ liệu sẽ được hiển thị tại đây sau khi gọi AJAX -->
        </tbody>
    </table>
</div>

@section scripts {
<script>
        // Khi người dùng thay đổi giá trị của Dropdown
        document.getElementById('SelectedProfileGroup').addEventListener('change', function () {
            loadProfileOrbitasByGroup(); // Gọi hàm để lấy dữ liệu mới
        });

        function loadProfileOrbitasByGroup() {
            var selectedGroupId = document.getElementById('SelectedProfileGroup').value;
            var messageDiv = document.getElementById('groupMessage'); // Lấy thẻ để hiển thị thông báo

            // Hiển thị thông báo ID nhóm đã chọn
            messageDiv.style.display = 'block'; // Hiển thị thẻ thông báo
            messageDiv.className = 'alert alert-info'; // Thiết lập class thông báo

            // Kiểm tra xem người dùng đã chọn nhóm chưa
            if (!selectedGroupId || selectedGroupId == 0) {
                messageDiv.innerHTML = 'Vui lòng chọn một nhóm hợp lệ.'; // Cập nhật thông báo
                return; // Không gửi yêu cầu AJAX nếu chưa chọn nhóm
            }

            // Cập nhật thông báo với ID nhóm đã chọn
            messageDiv.innerHTML = 'Người dùng đã chọn nhóm có ID: ' + selectedGroupId;

            // Gửi yêu cầu AJAX đến server để lấy danh sách ProfileOrbita theo nhóm
            $.ajax({
                url: '@Url.Action("GetProfileOrbitasByGroup", "Home", new { area = "User" })', // Đảm bảo đúng area nếu có
                type: 'GET',
                data: { profileGroupId: selectedGroupId }, // Gửi ID nhóm lên server

                success: function (result) {
                    // Tìm phần body của bảng để hiển thị dữ liệu
                    var tbody = document.getElementById('profileOrbitaTableBody');
                    tbody.innerHTML = ''; // Xóa nội dung hiện tại của bảng

                    // Kiểm tra xem kết quả có dữ liệu không
                    if (result && result.length > 0) {
                        // Duyệt qua danh sách kết quả và thêm dữ liệu vào bảng
                        result.forEach(function (orbita) {
                            var row = `<tr>
                                        <td><input type="checkbox" id="${orbita.id}" name="orbitaCheckboxes" value="${orbita.id}" /></td>
                                        <td>${orbita.id}</td>
                                        <td>${orbita.profileName}</td>
                                        <td>113.23.108.245</td>
                                        <td>Vietnam</td>
                                        <td>${orbita.status}</td>
                                        <td>${orbita.profileGroupID}</td>
                                        <td><button id="${orbita.id}" onclick="buttonClicked(this.id)" class="btn btn-success px-4 raised d-flex gap-2">
                                                <i class="material-icons-outlined">account_circle</i>Mở</button></td>
                                        <td>
                                            <div class="btn-group">
                                                <button type="button" class="btn btn-outline-success">Sửa</button>
                                                <button type="button" class="btn btn-outline-danger">Xoá</button>
                                            </div>
                                        </td>
                                    </tr>`;
                            tbody.innerHTML += row; // Thêm dòng vào bảng
                        });
                    } else {
                        // Nếu không có dữ liệu, hiển thị thông báo
                        tbody.innerHTML = '<tr><td colspan="9" class="text-center">Không có dữ liệu</td></tr>';
                    }
                },
                error: function (error) {
                    // In lỗi ra console nếu xảy ra lỗi trong quá trình gọi AJAX
                    console.error("Lỗi khi tải dữ liệu:", error);
                    alert("Có lỗi xảy ra khi tải dữ liệu.");
                }
            });
        }

</script>
}